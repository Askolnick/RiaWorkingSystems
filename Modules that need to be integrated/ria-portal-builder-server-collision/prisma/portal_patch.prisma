// --- Portal persistence patch (v1) ---
model DashboardLayout {
  id        String   @id @db.Uuid
  tenantId  String   @db.Uuid
  userId    String   @db.Uuid     // link to User.id
  name      String   @default("default")
  cols      Int      @default(12)
  rowHeight Int      @default(90)
  gap       Int      @default(8)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  widgets   DashboardWidget[]

  @@unique([tenantId, userId, name])
  @@index([tenantId, userId])
  @@map("dashboard_layouts")
}

model DashboardWidget {
  id        String   @id @db.Uuid
  layoutId  String   @db.Uuid
  key       String                  // WidgetDef key
  x         Int
  y         Int
  w         Int
  h         Int
  props     Json
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  layout DashboardLayout @relation(fields: [layoutId], references: [id], onDelete: Cascade)

  @@index([layoutId, y, x])
  @@map("dashboard_widgets")
}
